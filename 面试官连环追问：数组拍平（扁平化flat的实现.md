# é¢è¯•å®˜è¿ç¯è¿½é—®ï¼šæ•°ç»„æ‹å¹³ï¼ˆæ‰å¹³åŒ–ï¼‰ flat æ–¹æ³•å®ç° 

## ä¸€æ®µä»£ç æ€»ç»“ `Array.prototype.flat()` ç‰¹æ€§

> æ³¨ï¼šæ•°ç»„æ‹å¹³æ–¹æ³• `Array.prototype.flat()` ä¹Ÿå«æ•°ç»„æ‰å¹³åŒ–ã€æ•°ç»„æ‹‰å¹³ã€æ•°ç»„é™ç»´ã€‚æœ¬æ–‡ç»Ÿä¸€å«ï¼šæ•°ç»„æ‹å¹³

```
const animals = ["ğŸ·", ["ğŸ¶", "ğŸ‚"], ["ğŸ", ["ğŸ‘", ["ğŸ²"]], "ğŸ›"]];

// ä¸ä¼ å‚æ•°æ—¶ï¼Œé»˜è®¤â€œæ‹‰å¹³â€ä¸€å±‚
animals.flat();
// ["ğŸ·", "ğŸ¶", "ğŸ‚", "ğŸ", ["ğŸ‘", ["ğŸ²"]], "ğŸ›"]

// ä¼ å…¥ä¸€ä¸ªæ•´æ•°å‚æ•°ï¼Œæ•´æ•°å³â€œæ‹‰å¹³â€çš„å±‚æ•°
animals.flat(2);
// ["ğŸ·", "ğŸ¶", "ğŸ‚", "ğŸ", "ğŸ‘", ["ğŸ²"], "ğŸ›"]

// Infinity å…³é”®å­—ä½œä¸ºå‚æ•°æ—¶ï¼Œæ— è®ºå¤šå°‘å±‚åµŒå¥—ï¼Œéƒ½ä¼šè½¬ä¸ºä¸€ç»´æ•°ç»„
animals.flat(Infinity);
// ["ğŸ·", "ğŸ¶", "ğŸ‚", "ğŸ", "ğŸ‘", "ğŸ²", "ğŸ›"]

// ä¼ å…¥ <=0 çš„æ•´æ•°å°†è¿”å›åŸæ•°ç»„ï¼Œä¸â€œæ‹‰å¹³â€
animals.flat(0);
animals.flat(-10);
// ["ğŸ·", ["ğŸ¶", "ğŸ‚"], ["ğŸ", ["ğŸ‘", ["ğŸ²"]], "ğŸ›"]];

// å¦‚æœåŸæ•°ç»„æœ‰ç©ºä½ï¼Œflat()æ–¹æ³•ä¼šè·³è¿‡ç©ºä½ã€‚
["ğŸ·", "ğŸ¶", "ğŸ‚", "ğŸ",,].flat();
// ["ğŸ·", "ğŸ¶", "ğŸ‚", "ğŸ"]
```

### `Array.prototype.flat()` ç‰¹æ€§æ€»ç»“

- `Array.prototype.flat()` ç”¨äºå°†åµŒå¥—çš„æ•°ç»„â€œæ‹‰å¹³â€ï¼Œå˜æˆä¸€ç»´çš„æ•°ç»„ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå¯¹åŸæ•°æ®æ²¡æœ‰å½±å“ã€‚
- ä¸ä¼ å‚æ•°æ—¶ï¼Œé»˜è®¤â€œæ‹‰å¹³â€ä¸€å±‚ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæƒ³è¦â€œæ‹‰å¹³â€çš„å±‚æ•°ã€‚
- ä¼ å…¥ `<=0` çš„æ•´æ•°å°†è¿”å›åŸæ•°ç»„ï¼Œä¸â€œæ‹‰å¹³â€
- `Infinity` å…³é”®å­—ä½œä¸ºå‚æ•°æ—¶ï¼Œæ— è®ºå¤šå°‘å±‚åµŒå¥—ï¼Œéƒ½ä¼šè½¬ä¸ºä¸€ç»´æ•°ç»„
- å¦‚æœåŸæ•°ç»„æœ‰ç©ºä½ï¼Œ`Array.prototype.flat()` ä¼šè·³è¿‡ç©ºä½ã€‚

### ç¬¬ä¸€é—®ï¼šå®ç°ä¸€ä¸ªç®€å•çš„æ•°ç»„æ‹å¹³ `flat` å‡½æ•°

å¦‚ä½•å®ç°å‘¢ï¼Œæ€è·¯éå¸¸ç®€å•ï¼šå®ç°ä¸€ä¸ªæœ‰æ•°ç»„æ‹å¹³åŠŸèƒ½çš„ `flat` å‡½æ•°ï¼Œ**æˆ‘ä»¬è¦åšçš„å°±æ˜¯åœ¨æ•°ç»„ä¸­æ‰¾åˆ°æ˜¯æ•°ç»„ç±»å‹çš„å…ƒç´ ï¼Œç„¶åå°†ä»–ä»¬å±•å¼€**ã€‚è¿™å°±æ˜¯å®ç°æ•°ç»„æ‹å¹³ `flat` æ–¹æ³•çš„å…³é”®æ€è·¯ã€‚

æœ‰äº†æ€è·¯ï¼Œæˆ‘ä»¬å°±éœ€è¦è§£å†³å®ç°è¿™ä¸ªæ€è·¯éœ€è¦å…‹æœçš„å›°éš¾ï¼š

- **ç¬¬ä¸€ä¸ªè¦è§£å†³çš„å°±æ˜¯éå†æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼›**
- **ç¬¬äºŒä¸ªè¦è§£å†³çš„å°±æ˜¯åˆ¤æ–­å…ƒç´ æ˜¯å¦æ˜¯æ•°ç»„ï¼›**
- **ç¬¬ä¸‰ä¸ªè¦è§£å†³çš„å°±æ˜¯å°†æ•°ç»„çš„å…ƒç´ å±•å¼€ä¸€å±‚ï¼›**

#### éå†æ•°ç»„çš„æ–¹æ¡ˆ

éå†æ•°ç»„å¹¶å–å¾—æ•°ç»„å…ƒç´ çš„æ–¹æ³•éå¸¸ä¹‹å¤šï¼Œ**åŒ…æ‹¬ä¸”ä¸é™äºä¸‹é¢å‡ ç§**ï¼š

- `for å¾ªç¯`
- `for...of`
- `for...in`
- `forEach()`
- `entries()`
- `keys()`
- `values()`
- `reduce()`    åˆ’é‡ç‚¹
- `map()`

```js
const arr = [1, 2, 3, 4, [1, 2, 3, [1, 2, 3, [1, 2, 3]]], 5, "string", { name: "å¼¹é“è›‹åŒå­¦" }];
// éå†æ•°ç»„çš„æ–¹æ³•æœ‰å¤ªå¤šï¼Œæœ¬æ–‡åªæšä¸¾å¸¸ç”¨çš„å‡ ç§
// for å¾ªç¯
for (let i = 0; i < arr.length; i++) {
  console.log(arr[i]);
}
// for...of
for (let value of arr) {
  console.log(value);
}
// for...in
for (let i in arr) {
  console.log(arr[i]);
}
// forEach å¾ªç¯
arr.forEach(value => {
  console.log(value);
});
// entriesï¼ˆï¼‰
for (let [index, value] of arr.entries()) { //è§£åŒ…
  console.log(value);
}
// keys()
for (let index of arr.keys()) {
  console.log(arr[index]);
}
// values()
for (let value of arr.values()) {
  console.log(value);
}
// reduce()
arr.reduce((pre, cur) => {
  console.log(cur);
}, []);
// map()
arr.map(value => console.log(value));
```

#### åˆ¤æ–­å…ƒç´ æ˜¯æ•°ç»„çš„æ–¹æ¡ˆ

- `instanceof`
- `constructor`
- `Object.prototype.toString`
- `isArray`

```
const arr = [1, 2, 3, 4, [1, 2, 3, [1, 2, 3, [1, 2, 3]]], 5, "string", { name: "å¼¹é“è›‹åŒå­¦" }];
arr instanceof Array
// true
arr.constructor === Array
// true
Object.prototype.toString.call(arr) === '[object Array]'
// true
Array.isArray(arr)
// true
```

**è¯´æ˜**ï¼š

- `instanceof` æ“ä½œç¬¦æ˜¯å‡å®šåªæœ‰ä¸€ç§å…¨å±€ç¯å¢ƒï¼Œå¦‚æœç½‘é¡µä¸­åŒ…å«å¤šä¸ªæ¡†æ¶ï¼Œå¤šä¸ªå…¨å±€ç¯å¢ƒï¼Œå¦‚æœä½ ä»ä¸€ä¸ªæ¡†æ¶å‘å¦ä¸€ä¸ªæ¡†æ¶ä¼ å…¥ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆä¼ å…¥çš„æ•°ç»„ä¸åœ¨ç¬¬äºŒä¸ªæ¡†æ¶ä¸­åŸç”Ÿåˆ›å»ºçš„æ•°ç»„åˆ†åˆ«å…·æœ‰å„è‡ªä¸åŒçš„æ„é€ å‡½æ•°ã€‚ï¼ˆæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šä¸å‡†ç¡®ï¼‰

- `typeof` æ“ä½œç¬¦å¯¹æ•°ç»„å–ç±»å‹å°†è¿”å› `object`

- å› ä¸º` constructor` å¯ä»¥è¢«é‡å†™ï¼Œæ‰€ä»¥ä¸èƒ½ç¡®ä¿ä¸€å®šæ˜¯æ•°ç»„ã€‚

  ```
  const str = 'abc';
  str.constructor = Array;
  str.constructor === Array 
  // true
  ```

#### å°†æ•°ç»„çš„å…ƒç´ å±•å¼€ä¸€å±‚çš„æ–¹æ¡ˆ

- æ‰©å±•è¿ç®—ç¬¦ + `concat`

`concat()` æ–¹æ³•ç”¨äºåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªæ•°ç»„ï¼Œåœ¨æ‹¼æ¥çš„è¿‡ç¨‹ä¸­åŠ ä¸Šæ‰©å±•è¿ç®—ç¬¦ä¼šå±•å¼€ä¸€å±‚æ•°ç»„ã€‚è¯¦ç»†è§ä¸‹é¢çš„ä»£ç ã€‚

- `conca`t +` apply`

è¿™ä¸ªæ–¹æ³•å¾ˆå·§å¦™ å°±æ˜¯è¿æ¥æ•°å­—ï¼Œæˆ‘ä»¬å§æ•°ç»„è§£åŒ…ç„¶åå»è¿æ¥3ä¹‹å°±è¡Œ



ä¸»è¦æ˜¯åˆ©ç”¨ `apply` åœ¨ç»‘å®šä½œç”¨åŸŸæ—¶ï¼Œä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„æˆ–è€…ç±»æ•°ç»„å¯¹è±¡ï¼Œå…¶ä¸­çš„æ•°ç»„å…ƒç´ å°†ä½œä¸ºå•ç‹¬çš„å‚æ•°ä¼ ç»™ `func` å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯åœ¨è°ƒç”¨ `apply` å‡½æ•°çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå°†ä¼ å…¥çš„æ•°ç»„ä¸€ä¸ªä¸€ä¸ªçš„ä¼ å…¥åˆ°è¦æ‰§è¡Œçš„å‡½æ•°ä¸­ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“å¯¹æ•°ç»„è¿›è¡Œäº†ä¸€å±‚çš„å±•å¼€ã€‚

- `toString` + `split`

ä¸æ¨èä½¿ç”¨ `toString` + `split` æ–¹æ³•ï¼Œå› ä¸ºæ“ä½œå­—ç¬¦ä¸²æ˜¯å’Œå±é™©çš„äº‹æƒ…ï¼Œåœ¨[ä¸Šä¸€æ–‡ç« ](https://juejin.im/post/5decf09de51d45584d238319)ä¸­æˆ‘åšäº†ä¸€ä¸ªæ“ä½œå­—ç¬¦ä¸²çš„æ¡ˆä¾‹è¿˜è¢«è®¸å¤šå°ä¼™ä¼´ä»¬æ‰¹è¯„äº†ã€‚å¦‚æœæ•°ç»„ä¸­çš„å…ƒç´ æ‰€æœ‰éƒ½æ˜¯æ•°å­—çš„è¯ï¼Œ`toString` +` split` æ˜¯å¯è¡Œçš„ï¼Œå¹¶ä¸”æ˜¯ä¸€æ­¥æå®šã€‚

### æ–¹æ³•ä¸€

```js
const arr = [1, 2, 3, 4, [1, 2, 3, [1, 2, 3, [1, 2, 3]]], 5, "string", { name: "å¼¹é“è›‹åŒå­¦" }];
// concat + é€’å½’
function flat(arr) {
  let arrResult = [];
  arr.forEach(item => {
    if (Array.isArray(item)) {
      console.log(arguments)
      console.log(arguments.callee)
      arrResult = arrResult.concat(arguments.callee(item));   // é€’å½’
      // æˆ–è€…ç”¨æ‰©å±•è¿ç®—ç¬¦
      // arrResult.push(...arguments.callee(item));
    } else {
      arrResult.push(item);
    }
  });
  return arrResult;
}
flat(arr)
// [1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 1, 2, 3, 5, "string", { name: "å¼¹é“è›‹åŒå­¦" }];


/*arguments.callee(item)çš„è§£é‡Š*/
a rgumentså°±æ˜¯ å½“å‰å‡½æ•°çš„å‚æ•°ã€‚  ä»–ä¸‹é¢æœ‰ä¸€ä¸ªå±æ€§å°±æ˜¯ã€‚callee  å®ƒæ˜¯ä¸€ä¸ªæŒ‡é’ˆ æŒ‡å‘äº†ä½¿ç”¨å‚æ•°çš„æ–¹æ³• ä¹Ÿå°±æ˜¯å½“å‰çš„æ–¹æ³•ã€‚ è¿™æ ·å®ç°äº†ä½æŸœ
```

### æ–¹æ³•äºŒ ç”¨ `reduce` å®ç° `flat` å‡½æ•°

```
const arr = [1, 2, 3, 4, [1, 2, 3, [1, 2, 3, [1, 2, 3]]], 5, "string", { name: "å¼¹é“è›‹åŒå­¦" }]
const flat = arr =>{
	return arr.reduce((pre,cur)=>{
	return pre.concat(Array.isArray(cur)?flat(cur):cur);
	}, [])
}

flat(arr)
```

### ç¬¬ä¸‰é—®ï¼šä½¿ç”¨æ ˆçš„æ€æƒ³å®ç° `flat` å‡½æ•°

```js
// æ ˆæ€æƒ³
function flat(arr) {
  const result = []; 
  const stack = [].concat(arr);  // å°†æ•°ç»„å…ƒç´ æ‹·è´è‡³æ ˆï¼Œç›´æ¥èµ‹å€¼ä¼šæ”¹å˜åŸæ•°ç»„
  //å¦‚æœæ ˆä¸ä¸ºç©ºï¼Œåˆ™å¾ªç¯éå†
  while (stack.length !== 0) {
    const val = stack.pop(); 
    if (Array.isArray(val)) {
      stack.push(...val); //å¦‚æœæ˜¯æ•°ç»„å†æ¬¡å…¥æ ˆï¼Œå¹¶ä¸”å±•å¼€äº†ä¸€å±‚
    } else {
      result.unshift(val); //å¦‚æœä¸æ˜¯æ•°ç»„å°±å°†å…¶å–å‡ºæ¥æ”¾å…¥ç»“æœæ•°ç»„ä¸­
    }
  }
  return result;
}
const arr = [1, 2, 3, 4, [1, 2, 3, [1, 2, 3, [1, 2, 3]]], 5, "string", { name: "å¼¹é“è›‹åŒå­¦" }]
flat(arr)
// [1, 2, 3, 4, 1, 2, 3, 1, 2, 3, 1, 2, 3, 5, "string", { name: "å¼¹é“è›‹åŒå­¦" }];
```

### ç¬¬å››é—®ï¼šé€šè¿‡ä¼ å…¥æ•´æ•°å‚æ•°æ§åˆ¶â€œæ‹‰å¹³â€å±‚æ•°

```
//æ­¤æ—¶æœ€å¥½ä¸è¦å†™ç®­å¤´å‡½æ•°äº†
function flat(arr,num=1){
	return num>0 ? 
	 arr.reduce( (pre,cur) => pre.concat(Array.isArray(cur)?flat(cur,num-1):cur), [] )
	:arr.slice();//è¿”å›è‡ªå·±ä¸ª
}

const arr = [1, 2, 3, 4, [1, 2, 3, [1, 2, 3, [1, 2, 3]]], 5, "string", { name: "å¼¹é“è›‹åŒå­¦" }]
flat(arr, Infinity);
```

